<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Manage Dishes | Tasty Talk</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='manage_user.css') }}">
</head>
<body>
  <div class="container">
    <!-- Sidebar -->
    <div class="sidebar">
      <img class="input-icon" src="{{ url_for('static', filename='assets/logo.png') }}" alt="Tasty Talk Logo">
      <ul class="nav">
        <li><a href="/dashboard"><img src="{{ url_for('static', filename='assets/dashboard.png') }}">Dashboard</a></li>
        <li><a href="/add_dish"><img src="{{ url_for('static', filename='assets/dish.png') }}">Add Dish</a></li>
        <li><a href="/manage_dish"><img src="{{ url_for('static', filename='assets/manage.png') }}">Manage</a></li>
        <li><a href="/manage_users"><img src="{{ url_for('static', filename='assets/user.png') }}">User</a></li>
      </ul>
      <div class="logout" >
        <a href="/logout" > <img src="{{ url_for('static', filename='assets/logout.png') }}"> Logout </a>
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <div style="display: flex; justify-content: space-between; align-items: center; width: 100%;">
        <h2>Manage Users</h2>
        <button onclick="openAddUserModal()" style="padding: 8px 12px; background-color: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer;">
          Add User
        </button>
      </div>

      <div style="display: flex; justify-content: space-between; align-items: center; width: 100%; margin: 20px 0;">
        <!-- Filter Section -->
        <div style="display: flex; gap: 20px; align-items: center;">
          <div class="filter-container">
            <label for="genderFilter" class="filter-label">Filter by Gender:</label>
            <select id="genderFilter" class="filter-select" onchange="filterUsers()">
              <option value="">All Genders</option>
              <option value="Male">Male</option>
              <option value="Female">Female</option>
              <option value="Prefer not to say">Prefer not to say</option>
              <option value="Other">Other</option>
            </select>
          </div>
          
          <div class="filter-container">
            <label for="ageFilter" class="filter-label">Filter by Age:</label>
            <select id="ageFilter" class="filter-select" onchange="filterUsers()">
              <option value="">All Ages</option>
              <option value="18-25">18-25</option>
              <option value="26-35">26-35</option>
              <option value="36-45">36-45</option>
              <option value="46-55">46-55</option>
              <option value="56+">56+</option>
            </select>
          </div>
        </div>

        <!-- Search Section -->
        <div class="search-container">
          <input type="text" id="searchInput" class="search-input" placeholder="Search Users..." onkeyup="searchUsers()">
          
        </div>
      </div>

      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>Fullname</th>
              <th>Age</th>
              <th>Gender</th>
              <th>Username</th>
              <th>Email</th>
              <th>Cooking Level</th>
            </tr>
          </thead>
          <tbody>
            {% for user in users %}
              <tr>
                <td>{{ user.fullName }}</td>
                <td>{{ user.age }}</td>
                <td>{{ user.gender }}</td>
                <td>{{ user.username }}</td>
                <td>{{ user.email }}</td>
                <td><span class="cooking-level {{ user.cookingLevel.lower().replace(' ', '-') }}">{{ user.cookingLevel }}</span></td>
              </tr>
            {% endfor %}
          </tbody>
          
        </table>
      </div>
    </div>
  </div>

  <!-- Add User Modal -->
  <div id="addUserModal" class="modal">
    <div class="modal-content">
      <span class="close-btn" onclick="closeAddUserModal()">&times;</span>
      <h3>Add New User</h3>
      <form action="/add_user" method="post">
        <label>Full Name</label>
        <input type="text" name="fullName" required>
        
        <label>Birthday</label>
        <input type="date" name="birthday" required onchange="calculateAge()">
        
        <label>Age</label>
        <input type="number" name="age" id="ageField" readonly>
        
        <label>Gender</label>
        <select name="gender" required>
          <option value="">Select Gender</option>
          <option value="Male">Male</option>
          <option value="Female">Female</option>
          <option value="Prefer not to say">Prefer not to say</option>
          <option value="Other">Other</option>
        </select>
        
        <label>Username</label>
        <input type="text" name="username" required>
        
        <label>Email</label>
        <input type="email" name="email" required>
        
        <label>Password</label>
        <input type="password" name="password" required minlength="6">
        
        <button type="submit" style="margin-top: 20px;">Add User</button>
      </form>
    </div>
  </div>

  <script>
    function openAddUserModal() {
      document.getElementById('addUserModal').style.display = 'flex';
    }
    
    function closeAddUserModal() {
      document.getElementById('addUserModal').style.display = 'none';
    }
    
    function calculateAge() {
      const birthday = document.querySelector('input[name="birthday"]').value;
      if (birthday) {
        const birthDate = new Date(birthday);
        const today = new Date();
        let age = today.getFullYear() - birthDate.getFullYear();
        const monthDiff = today.getMonth() - birthDate.getMonth();
        if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
          age--;
        }
        document.getElementById('ageField').value = age;
      }
    }
    
    function searchUsers() {
      const input = document.getElementById('searchInput').value.toLowerCase();
      const tableRows = document.querySelectorAll('.table-container tbody tr');
      tableRows.forEach(row => {
        const fullName = row.cells[0].textContent.toLowerCase();
        const username = row.cells[3].textContent.toLowerCase();
        const email = row.cells[4].textContent.toLowerCase();
        const matches = fullName.includes(input) || username.includes(input) || email.includes(input);
        row.style.display = matches ? '' : 'none';
      });
    }
    
    function filterUsers() {
      const selectedGender = document.getElementById('genderFilter').value;
      const selectedAge = document.getElementById('ageFilter').value;
      const tableRows = document.querySelectorAll('.table-container tbody tr');
      
      tableRows.forEach(row => {
        const gender = row.cells[2].textContent;
        const age = parseInt(row.cells[1].textContent);
        
        let genderMatch = !selectedGender || gender === selectedGender;
        let ageMatch = true;
        
        if (selectedAge) {
          switch(selectedAge) {
            case '18-25':
              ageMatch = age >= 18 && age <= 25;
              break;
            case '26-35':
              ageMatch = age >= 26 && age <= 35;
              break;
            case '36-45':
              ageMatch = age >= 36 && age <= 45;
              break;
            case '46-55':
              ageMatch = age >= 46 && age <= 55;
              break;
            case '56+':
              ageMatch = age >= 56;
              break;
          }
        }
        
        row.style.display = (genderMatch && ageMatch) ? '' : 'none';
      });
    }
  </script>
</body>
</html>
